<div class="results-container">
  <div *ngIf="isExtracting" class="loading-overlay">
    <mat-progress-spinner mode="indeterminate" diameter="50"></mat-progress-spinner>
    <p>Processing...</p>
  </div>

  <mat-expansion-panel *ngIf="extractionError && !isExtracting" class="error-panel" [expanded]="true">
     <mat-expansion-panel-header>
         <mat-panel-title>
             <mat-icon color="warn">error_outline</mat-icon> Extraction Error
         </mat-panel-title>
     </mat-expansion-panel-header>
     <p>{{ extractionError }}</p>
  </mat-expansion-panel>


  <mat-card *ngIf="!isExtracting && !extractionError && originalText" class="results-card">
    <mat-card-header>
      <mat-card-title>Labeling Interface</mat-card-title>
      <mat-card-subtitle>Select text to add annotations, click existing annotations to delete.</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
        <div #highlightedTextContainer
            class="highlighted-text-container"
            (mouseup)="handleTextSelection($event)">
         <ng-container *ngFor="let segment of highlightedSegments">
            <mark *ngIf="segment.isAnnotation && segment.annotation"
                 [id]="segment.annotation.id"
                 [title]="segment.annotation.type"
                 [style.backgroundColor]="segment.annotation.color || '#ffecb3'" class="entity-annotation"
                 (click)="handleAnnotationClick(segment.annotation, $event)"
                 (contextmenu)="preventContextMenu($event)"> {{ segment.text }}
           </mark>
           <span *ngIf="!segment.isAnnotation">
             {{ segment.text }}
           </span>
         </ng-container>
       </div>
    </mat-card-content>
  </mat-card>

  <mat-card *ngIf="!isExtracting && !extractionError && !originalText" class="no-results-card">
    <mat-card-content>
       <p class="placeholder-text">Upload a file and click Extract to begin labeling.</p>
    </mat-card-content>
  </mat-card>
</div>